<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.everycloud.service.mapper.UserMapper">

	<select id="getUser" resultType="UserDTO">
		SELECT /* UserMapper.getUser */
			ID,
			NICKNAME,
			EMAIL,
			AUTH,
			g.NO as GROUP_NO,
			g.NAME as GROUP_NAME
		FROM USER u, GROUP_SETTING g
		WHERE ID = #{id} and u.GROUP_NO = g.NO
	</select>

	<select id="getUserList" resultType="UserDTO">
		SELECT /* UserMapper.getUser */
			ID,
			NICKNAME,
			g.NO as GROUP_NO,
			g.NAME as GROUP_NAME
		FROM USER u, GROUP_SETTING g
		WHERE u.GROUP_NO = g.NO
		ORDER BY (CASE WHEN g.NO = #{groupNo} THEN 1 ELSE 2 END),
				<choose>
					<when test="sort == null or sort.equals('') or sort.equals('id')">ID </when>
					<when test="sort.equals('nickname')">NICKNAME </when>
					<when test="sort.equals('groupName')">GROUP_NAME </when>
					<otherwise>ID </otherwise>
				</choose>
				<choose>
					<when test="order == null or order.equals('') or order.equals('asc')">ASC</when>
					<otherwise>DESC</otherwise>
				</choose>
	</select>

	<select id="getUserInfo" resultType="UserDTO">
		SELECT /* UserMapper.getUserInfo */
		    ID,
		    NICKNAME,
		    EMAIL,
		    AUTH
		FROM USER
		WHERE ID = #{id}
	</select>

	<select id="getPass" resultType="string">
		SELECT /* UserMapper.getPass */
		    PASS
		FROM USER
		WHERE ID = #{id}
	</select>

	<select id="getAdmin" resultType="UserDTO">
		SELECT /* UserMapper.getAdmin */
		    ID,
		    NICKNAME,
		    EMAIL,
		    AUTH
		FROM USER
		WHERE AUTH = 'Y'
	</select>

	<update id="updateUser">
		UPDATE /* UserMapper.updateUser */
		    USER
		    <set>
				<if test="user.id != null and !user.id.equals('')">
					ID = #{user.id},
				</if>
			    <if test="user.pass != null and !user.pass.equals('')">
					PASS = #{user.pass},
				</if>
				<if test="user.nickname != null and !user.nickname.equals('')">
					NICKNAME = #{user.nickname},
				</if>
				<if test="user.email != null and !user.email.equals('')">
					EMAIL = #{user.email},
				</if>
				<if test="user.groupNo != null and !user.groupNo.equals('')">
					NO = #{user.no},
				</if>
			</set>
			<where>
				<if test="origId != null and !origId.equals('')">
					ID = #{origId}
				</if>
				<if test="origId == null or origId.equals('')">
					AND ID = #{user.id}
				</if>
			</where>
	</update>
</mapper>